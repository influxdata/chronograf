machine:
  node:
    version: 5.1.0
  pre:
    # Use Phantom 2, not Phantom 1 as preinstalled on Circle.
    # https://discuss.circleci.com/t/add-phantomjs-2-1-1-to-the-platform/1755/2
    - sudo curl --output /usr/local/bin/phantomjs https://s3.amazonaws.com/circle-downloads/phantomjs-2.1.1

dependencies:
  pre:
    # Make npm commands respect NPM_TOKEN (which we have set via CircleCI)
    # https://github.com/npm/npm/issues/8356#issuecomment-174320077
    - 'echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" > ~/.npmrc'

test:
  pre:
    - npm run lint
  post:
    - npm run build && npm run pack:osx
    # Until we build .dmg files, we'll distribute the zipped app file.
    - cd artifacts/InfluxDBDashboard-darwin-x64 && zip -y -r ${CIRCLE_ARTIFACTS}/InfluxDBDashboard.app.zip InfluxDBDashboard.app
